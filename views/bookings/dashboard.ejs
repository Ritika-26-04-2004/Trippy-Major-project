<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Bookings</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }
    .table th {
      background: #343a40;
      color: white;
      text-align: center;
      vertical-align: middle;
    }
    .table td {
      vertical-align: middle;
      text-align: center;
    }
    .booking-img {
      height: 70px;
      width: 100px;
      object-fit: cover;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h3 class="text-center mt-3">Hi, <%= currUser.username %> ðŸ‘‹</h3>
  <div class="container py-5">
    <h1 class="mb-4 text-center">My Bookings</h1>

    <% if (bookings.length === 0) { %>
      <div class="alert alert-info text-center">
        You have no bookings yet.
      </div>
    <% } else { %>
      <div class="table-responsive shadow-sm">
        <table class="table table-bordered table-striped align-middle">
          <thead>
            <tr>
              <th>Image</th>
              <th>Listing</th>
              <th>Adults</th>
              <th>Kids</th>
              <th>Total Amount</th>
              <th>Status</th>
              <th>Booked On</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% bookings.forEach(booking => { %>
              <tr>
                <td>
                  <% if (booking.listing && booking.listing.image) { %>
                    <img src="<%= booking.listing.image.url %>" class="booking-img" alt="<%= booking.listing.title %>">
                  <% } else { %>
                    <img src="https://via.placeholder.com/100x70?text=No+Image" class="booking-img" alt="No Image">
                  <% } %>
                </td>
                <td>
                  <% if (booking.listing) { %>
                    <strong><%= booking.listing.title %></strong><br>
                    <a href="/listings/<%= booking.listing._id %>" class="btn btn-link btn-sm p-0">View Listing</a>
                  <% } else { %>
                    <span class="text-muted">Listing Deleted</span>
                  <% } %>
                </td>
                <td><%= booking.adults %></td>
                <td><%= booking.kids %></td>
                <td>â‚¹<%= booking.totalAmount %></td>
                <td>
                  <% if (booking.status === "paid") { %>
                    <span class="badge bg-success">Paid</span>
                  <% } else if (booking.status === "pending") { %>
                    <span class="badge bg-warning text-dark">Pending</span>
                  <% } else { %>
                    <span class="badge bg-danger">Cancelled</span>
                  <% } %>
                </td>
                <td><%= booking.createdAt.toDateString() %></td>
                <td>
                  <% if (booking.status === "pending" || booking.status === "paid") { %>
                    <form action="/bookings/<%= booking._id %>/cancel" method="POST">
                      <button type="submit" class="btn btn-danger btn-sm">Cancel</button>
                    </form>
                  <% } else { %>
                    <em>â€”</em>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
